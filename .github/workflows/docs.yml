name: Deploy MkDocs (api directory) to re-meta.github.io/api

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install dependencies
        run: |
          # If you keep a requirements file for the docs build, use it:
          # if [ -f api/requirements.txt ]; then pip install -r api/requirements.txt; fi
          # Otherwise ensure at least these:
          pip install -U pip
          pip install -e .
          pip install mkdocs-material mkdocstrings[python] mkdocs-autorefs

      - name: Build docs from api/mkdocs.yml
        run: |
          # If mkdocstrings needs to import your repo package, uncomment:
          # export PYTHONPATH="$GITHUB_WORKSPACE"
            python - <<'PY'
            import remeta.gendata, remeta.plot, remeta.configuration
            import inspect
            print("gendata members:", [n for n,_ in inspect.getmembers(remeta.gendata) if not n.startswith("__")][:30])
            print("plot members:",   [n for n,_ in inspect.getmembers(remeta.plot) if not n.startswith("__")][:30])
            PY
          mkdocs build -v --clean --config-file api/mkdocs.yml

      - name: Push api/site to re-meta/re-meta.github.io
        uses: peaceiris/actions-gh-pages@v4
        with:
          personal_token: ${{ secrets.PAGES_DEPLOY_TOKEN }}
          external_repository: re-meta/re-meta.github.io
          publish_branch: main
          destination_dir: api
          publish_dir: api/site
          keep_files: true
